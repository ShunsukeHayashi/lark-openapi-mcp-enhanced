# 🔧 Lark開発者コンソール - パーミッション設定ガイド

## 🎯 アプリ情報

**App ID**: `cli_a8d2e0082978902e`  
**App Secret**: `SQkCdptYmzrNa3MIfwmN2f7V5BXR2Ghz`  
**現在の状況**: Base作成機能は動作中

## 📋 ステップバイステップ設定手順

### Step 1: 開発者コンソールにアクセス

1. **ブラウザで開く**: [https://open.feishu.cn](https://open.feishu.cn)
2. **ログイン**: Larkアカウントでサインイン
3. **言語設定**: 右上で日本語に変更可能

### Step 2: アプリを選択

1. **アプリ一覧**を表示
2. **App ID**: `cli_a8d2e0082978902e` を探す
3. アプリ名をクリックして詳細画面に移動

### Step 3: 権限とスコープ設定

1. 左メニューから**「権限とスコープ」**をクリック
2. **「アプリに権限スコープを追加」**ボタンをクリック

### Step 4: 権限選択方法

#### 方法A: 個別選択（推奨）
以下の権限を個別に検索・追加：

**必須権限:**
- `bitable:app` (Base完全管理)
- `im:message:send_as_bot` (Bot送信)

**推奨権限:**
- `im:message` (メッセージ読み取り)
- `im:chat` (チャット管理)
- `docx:document` (ドキュメント作成)

#### 方法B: 一括インポート（効率的）
1. **「インポート」**ボタンをクリック
2. 以下のJSONコードを貼り付け：

```json
{
  "scopes": {
    "tenant": [
      "bitable:app",
      "im:message:send_as_bot",
      "im:message",
      "im:chat",
      "docx:document",
      "contact:user.base:readonly"
    ],
    "user": []
  }
}
```

3. **「実行」**をクリック

### Step 5: バージョン作成と公開

1. **「バージョン作成と公開」**タブをクリック
2. **「バージョン作成」**ボタンをクリック
3. 変更内容を確認
4. **「公開申請」**をクリック
5. 承認プロセスを完了

## 🔍 各権限の詳細説明

### Base関連権限
| 権限名 | 機能 | 重要度 |
|--------|------|--------|
| `bitable:app` | Base作成・編集・削除 | ✅ 必須 |
| `bitable:app:readonly` | Base読み取りのみ | 🟡 オプション |

### メッセージ関連権限
| 権限名 | 機能 | 重要度 |
|--------|------|--------|
| `im:message:send_as_bot` | Botメッセージ送信 | ✅ 必須 |
| `im:message` | メッセージ読み取り | 🟡 推奨 |
| `im:chat` | チャット作成・管理 | 🟡 推奨 |

### ドキュメント関連権限
| 権限名 | 機能 | 重要度 |
|--------|------|--------|
| `docx:document` | ドキュメント作成・編集 | 🟡 推奨 |
| `docs:doc` | Docs管理 | 🟢 オプション |

## 🚀 権限レベル別設定

### 🟢 最小設定（Base作成のみ）
```
✅ bitable:app
```

### 🟡 標準設定（Base + 通知）
```
✅ bitable:app
✅ im:message:send_as_bot
✅ im:message
```

### 🔴 完全設定（フル機能）
```
✅ bitable:app
✅ im:message:send_as_bot
✅ im:message
✅ im:chat
✅ docx:document
✅ contact:user.base:readonly
```

## ⚠️ 重要な注意事項

### 権限反映タイミング
- **インポート後**: 即座に反映
- **バージョン作成後**: 即座に反映
- **公開後**: 5-10分で完全反映

### よくある問題
1. **権限が見つからない**
   - 検索ボックスを使用
   - 正確な権限名を入力

2. **公開申請が通らない**
   - 権限の使用目的を明記
   - 必要最小限の権限のみ申請

3. **権限が反映されない**
   - 最大30分待機
   - ブラウザキャッシュをクリア

## 🔧 設定確認方法

### 権限テスト
設定完了後、以下で動作確認：

```bash
# 認証テスト
curl -s "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal" \
     -H "Content-Type: application/json" \
     -d '{"app_id":"cli_a8d2e0082978902e","app_secret":"SQkCdptYmzrNa3MIfwmN2f7V5BXR2Ghz"}'
```

### Claude Desktopテスト
```
「Lark MCPツールの権限状態を確認してください」
```

## 📞 トラブルシューティング

### ケース1: アプリが見つからない
**解決策**: 
- 正しいLarkアカウントでログイン確認
- アプリ作成者に権限を確認

### ケース2: 権限追加できない
**解決策**:
- アプリの管理者権限を確認
- 組織のポリシーを確認

### ケース3: 公開申請がエラー
**解決策**:
- 権限の使用目的を詳細記述
- 段階的に権限追加

## 🎯 推奨設定手順

### 初回設定（安全）
1. 最小権限でテスト
2. 動作確認後に段階的追加
3. 必要な機能のみ有効化

### 本格運用
1. 標準設定を適用
2. 追加機能は都度検討
3. 定期的な権限見直し

---

🔧 **設定に困った場合は、最小権限（bitable:app）から始めて段階的に追加することをお勧めします。**